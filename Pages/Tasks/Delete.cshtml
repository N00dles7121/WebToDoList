@page
@using WebApp.Data;
@using WebApp.Models;
@using Microsoft.Data.SqlClient;
@{
    ViewData["Title"] = "Delete";
}

@{
    var errorMessage = new System.Text.StringBuilder();
    try
    {
        ProgramContext context = new ProgramContext();
        int.TryParse(Request.Query["id"], out int id);

        var task = context.Tasks.FirstOrDefault(t => t.Id == id);

        context.Tasks.Remove(task);
        await context.SaveChangesAsync();
    }
    catch (SqlException ex)
    {
        for (int i = 0; i < ex.Errors.Count; i++)
        {
            errorMessage.Append("Index #" + i + "\n" +
            "Message: " + ex.Errors[i].Message + "\n" +
            "LineNumber: " + ex.Errors[i].LineNumber + "\n" +
            "Source: " + ex.Errors[i].Source + "\n" +
            "Procedure: " + ex.Errors[i].Procedure + "\n");
        }
    }

    Response.Redirect("/Tasks/Index");
}